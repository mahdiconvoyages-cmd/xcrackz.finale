# Nouveau Syst√®me de Tarification xCrackz

## Vue d'ensemble

Le nouveau syst√®me de tarification de xCrackz utilise un mod√®le bas√© sur les cr√©dits avec 5 plans tarifaires diff√©rents, des abonnements mensuels et annuels, et des co√ªts variables par fonctionnalit√©.

---

## üìã Les 5 Plans

### 1. üéØ Starter - 9,99‚Ç¨/mois
**10 cr√©dits par mois**

#### Inclus :
- ‚úÖ 10 missions maximum
- ‚úÖ 1 utilisateur
- ‚úÖ Facturation & Devis illimit√©s
- ‚úÖ Scan de documents illimit√©
- ‚úÖ Support par email

#### Id√©al pour :
- Convoyeurs ind√©pendants d√©butants
- Petites structures occasionnelles
- Test de la plateforme

---

### 2. ‚ö° Basic - 19,99‚Ç¨/mois
**25 cr√©dits par mois**

#### Inclus :
- ‚úÖ 25 missions maximum
- ‚úÖ 2 utilisateurs
- ‚úÖ Facturation & Devis illimit√©s
- ‚úÖ Scan de documents illimit√©
- ‚úÖ **Covoiturage inclus**
- ‚úÖ Support prioritaire

#### Id√©al pour :
- Petites √©quipes
- Convoyeurs r√©guliers
- Utilisation du covoiturage

---

### 3. ‚≠ê Pro - 49,99‚Ç¨/mois (POPULAIRE)
**100 cr√©dits par mois**

#### Inclus :
- ‚úÖ 100 missions maximum
- ‚úÖ 5 utilisateurs
- ‚úÖ Facturation & Devis illimit√©s
- ‚úÖ Scan de documents illimit√©
- ‚úÖ **Tracking GPS GRATUIT** ‚≠ê
- ‚úÖ Covoiturage inclus
- ‚úÖ Support prioritaire 24/7

#### Id√©al pour :
- Professionnels du convoyage
- PME en croissance
- Usage intensif de la plateforme

---

### 4. üèÜ Business - 79,99‚Ç¨/mois
**500 cr√©dits par mois**

#### Inclus :
- ‚úÖ 500 missions maximum
- ‚úÖ 10 utilisateurs
- ‚úÖ Facturation & Devis illimit√©s
- ‚úÖ Scan de documents illimit√©
- ‚úÖ **Tracking GPS GRATUIT** ‚≠ê
- ‚úÖ **API incluse**
- ‚úÖ Covoiturage illimit√©
- ‚úÖ Support d√©di√© 24/7

#### Id√©al pour :
- Grandes structures
- Int√©grations syst√®me
- Volume important de missions

---

### 5. üëë Enterprise - 119,99‚Ç¨/mois
**1500 cr√©dits par mois**

#### Inclus :
- ‚úÖ 1500 missions maximum
- ‚úÖ **Utilisateurs illimit√©s**
- ‚úÖ Facturation & Devis illimit√©s
- ‚úÖ Scan de documents illimit√©
- ‚úÖ **Tracking GPS GRATUIT** ‚≠ê
- ‚úÖ **API personnalis√©e**
- ‚úÖ Covoiturage illimit√©
- ‚úÖ **Formation √©quipe**
- ‚úÖ **Account manager d√©di√©**
- ‚úÖ Fonctionnalit√©s sur mesure

#### Id√©al pour :
- Grands groupes de transport
- Multi-sites
- Besoins sp√©cifiques

---

## üí∞ Abonnements Annuels

### √âconomisez 20% avec l'abonnement annuel !

| Plan | Prix Mensuel | Prix Annuel | √âconomie |
|------|-------------|-------------|----------|
| Starter | 9,99‚Ç¨ | **95,90‚Ç¨** | 23,98‚Ç¨ |
| Basic | 19,99‚Ç¨ | **191,90‚Ç¨** | 47,98‚Ç¨ |
| Pro | 49,99‚Ç¨ | **479,90‚Ç¨** | 119,98‚Ç¨ |
| Business | 79,99‚Ç¨ | **767,90‚Ç¨** | 191,98‚Ç¨ |
| Enterprise | 119,99‚Ç¨ | **1151,90‚Ç¨** | 287,98‚Ç¨ |

**Avantage** : Payez une fois pour l'ann√©e et √©conomisez l'√©quivalent de 2,4 mois !

---

## üéÆ Co√ªts des Fonctionnalit√©s en Cr√©dits

### Cr√©ation de Missions
**Co√ªt : 1 cr√©dit**
- Chaque nouvelle mission cr√©√©e consomme 1 cr√©dit
- Valable pour tous les plans

### Inspection V√©hicule
**Co√ªt : GRATUIT** ‚úÖ
- Inclus dans toutes les missions cr√©√©es
- Inspection avant et apr√®s transport
- Photos, signatures, rapports PDF
- Aucun cr√©dit consomm√©

### Tracking GPS
**Co√ªt : 1 cr√©dit par position**
**GRATUIT √† partir du plan Pro** ‚≠ê

- Enregistrement d'une position GPS
- **Plans Starter et Basic** : 1 cr√©dit par position
- **Plans Pro, Business, Enterprise** : GRATUIT illimit√©

### Publier Trajet Covoiturage
**Co√ªt : 2 cr√©dits**
- Cr√©er une offre de covoiturage
- D√©finir le trajet, date, prix
- Gestion des r√©servations

### R√©server Covoiturage
**Co√ªt : 2 cr√©dits**
- R√©server un trajet publi√©
- Acc√®s √† la messagerie avec le conducteur
- Confirmation de r√©servation

### Facturation & Devis
**Co√ªt : GRATUIT** ‚úÖ
- Acc√®s illimit√©
- Cr√©ation de factures
- Cr√©ation de devis
- Export PDF
- Inclus dans tous les plans

### Scan de Documents
**Co√ªt : GRATUIT** ‚úÖ
- Scanner des documents en illimit√©
- OCR automatique
- Stockage s√©curis√©
- Inclus dans tous les plans

---

## üîÑ Renouvellement des Cr√©dits

### Fonctionnement
- **P√©riode** : Tous les 30 jours
- **Date** : √Ä partir de la date de souscription
- **Cr√©dits** : Remis √† z√©ro et recharg√©s au niveau du plan
- **Non cumulables** : Les cr√©dits non utilis√©s ne sont pas report√©s

### Exemple
```
Souscription : 1er janvier
Plan : Pro (100 cr√©dits)

1er janvier : 100 cr√©dits
15 janvier : Utilise 40 cr√©dits ‚Üí Reste 60 cr√©dits
31 janvier : Reste 60 cr√©dits
1er f√©vrier : Renouvellement ‚Üí 100 cr√©dits (pas 160)
```

---

## üóÑÔ∏è Architecture Technique

### Tables de Base de Donn√©es

#### `credits_packages`
Stocke les plans tarifaires
```sql
- id: uuid
- name: text (Starter, Basic, Pro, Business, Enterprise)
- description: text
- credits: integer (10, 25, 100, 500, 1500)
- price: numeric (9.99, 19.99, 49.99, 79.99, 119.99)
- is_popular: boolean
- billing_period: text (monthly, annual)
- discount_percent: integer (20% pour annuel)
- free_tracking: boolean (Pro+)
```

#### `feature_costs`
Co√ªts des fonctionnalit√©s
```sql
- id: uuid
- feature_name: text
- feature_key: text (mission_create, tracking_location, etc.)
- description: text
- credit_cost: integer
- free_from_plan: text (pro, business, enterprise)
```

#### `credit_usage_log`
Historique d'utilisation
```sql
- id: uuid
- user_id: uuid
- feature_key: text
- credits_used: integer
- was_free: boolean
- reference_id: uuid (mission_id, covoiturage_id)
- created_at: timestamptz
```

### Fonction SQL `deduct_credits()`

Fonction intelligente qui :
1. V√©rifie le co√ªt de la fonctionnalit√©
2. V√©rifie le plan de l'utilisateur
3. D√©termine si la fonctionnalit√© est gratuite pour ce plan
4. D√©duit les cr√©dits si n√©cessaire
5. Log l'utilisation

```sql
SELECT deduct_credits(
  'user-uuid',
  'mission_create',
  'mission-uuid'
);

-- Retourne:
{
  "success": true,
  "credits_used": 1,
  "was_free": false,
  "new_balance": 99
}
```

---

## üéØ Logique de Gratuit√©

### Tracking GPS Gratuit

**Conditions :**
```
Plan >= Pro ET feature_key = 'tracking_location'
‚Üí Tracking GRATUIT
```

**Impl√©mentation :**
```typescript
if (userPlan === 'Pro' || userPlan === 'Business' || userPlan === 'Enterprise') {
  // Tracking gratuit, pas de d√©duction de cr√©dits
  tracking_free = true;
}
```

### Fonctionnalit√©s Toujours Gratuites

- Inspections v√©hicule (si mission cr√©√©e)
- Facturation & Devis
- Scan de documents

**Raison :** Ces fonctionnalit√©s sont essentielles au service et ne doivent pas limiter l'utilisation.

---

## üí≥ Int√©gration Paiement

### Processeur : Mollie

**Flux de paiement :**
1. Utilisateur choisit un plan (mensuel ou annuel)
2. Clic sur "Commencer"
3. Appel √† l'edge function `create-payment`
4. Cr√©ation session de paiement Mollie
5. Redirection vers Mollie
6. Paiement s√©curis√©
7. Webhook Mollie ‚Üí `mollie-webhook`
8. Activation de l'abonnement
9. Cr√©dits ajout√©s automatiquement

### M√©thodes de Paiement
- Cartes bancaires (Visa, Mastercard, Amex)
- PayPal
- Virement bancaire SEPA
- Apple Pay / Google Pay

---

## üìä Interface Utilisateur

### Page Shop (`/shop`)

**Fonctionnalit√©s :**
- Toggle Mensuel / Annuel
- Badge -20% sur abonnement annuel
- Badge POPULAIRE sur plan Pro
- 5 cartes de tarifs c√¥te √† c√¥te
- Section "Co√ªts des fonctionnalit√©s"
- Section Paiement s√©curis√©
- Section Garanties

**Affichage dynamique :**
- Charge les plans depuis la base de donn√©es
- Affiche les features selon le plan
- Calcule automatiquement le prix mensuel pour l'annuel

### Landing Page (`/`)

**Section Tarifs :**
- Pr√©sentation des 5 plans
- Features principales
- Co√ªts en cr√©dits explicites
- CTA "Commencer"
- Note sur √©conomie annuelle

---

## üîê S√©curit√© & RLS

### Policies Row Level Security

**`credits_packages`** : Lecture publique (plans actifs seulement)
**`feature_costs`** : Lecture publique (fonctionnalit√©s actives)
**`credit_usage_log`** : Utilisateurs voient leur propre historique, admins voient tout
**`user_credits`** : Utilisateurs g√®rent leurs propres cr√©dits

---

## üìà Analytics & Reporting

### Donn√©es √† Tracker

**Par utilisateur :**
- Cr√©dits consomm√©s par fonctionnalit√©
- Fonctionnalit√©s gratuites utilis√©es
- Historique de renouvellement
- Taux d'utilisation (cr√©dits utilis√©s / cr√©dits disponibles)

**Globalement :**
- Plans les plus populaires
- Fonctionnalit√©s les plus utilis√©es
- Taux de conversion annuel vs mensuel
- Churn rate par plan

---

## üöÄ Migration depuis Ancien Syst√®me

### √âtapes

1. **Anciens utilisateurs gratuits**
   - Migrer vers plan Starter (9,99‚Ç¨)
   - Offrir 1 mois gratuit

2. **Anciens utilisateurs Pro (29‚Ç¨)**
   - Migrer vers plan Pro (49,99‚Ç¨)
   - Communication des nouveaux avantages (tracking gratuit)
   - Offre de transition : premier mois √† 29‚Ç¨

3. **Donn√©es √† migrer**
   - Solde de cr√©dits actuel
   - Historique de transactions
   - Date d'expiration

### Communication

Email √† tous les utilisateurs avec :
- Comparaison ancien vs nouveau plan
- B√©n√©fices du nouveau syst√®me
- Guide des nouveaux co√ªts en cr√©dits
- FAQ

---

## üìû Support

### Questions Fr√©quentes

**Q : Que se passe-t-il si je manque de cr√©dits ?**
R : Vous ne pouvez plus cr√©er de missions/trajets jusqu'au prochain renouvellement ou upgrade de plan.

**Q : Puis-je acheter des cr√©dits suppl√©mentaires ?**
R : Non, les cr√©dits sont fixes par plan. Vous pouvez upgrader votre plan √† tout moment.

**Q : Les cr√©dits non utilis√©s sont-ils report√©s ?**
R : Non, les cr√©dits sont renouvel√©s tous les 30 jours et ne sont pas cumulables.

**Q : Le tracking GPS est-il vraiment gratuit pour Pro+ ?**
R : Oui, totalement illimit√© sans consommation de cr√©dits.

**Q : Puis-je changer de plan en cours de mois ?**
R : Oui, upgrade imm√©diat avec prorata. Downgrade effectif au prochain renouvellement.

---

## üìã Checklist de D√©ploiement

- [x] Migration base de donn√©es cr√©√©e
- [x] 5 nouveaux plans ins√©r√©s
- [x] Plans annuels g√©n√©r√©s (-20%)
- [x] Table feature_costs cr√©√©e
- [x] Fonction deduct_credits() cr√©√©e
- [x] Page Shop mise √† jour
- [x] Landing page mise √† jour
- [x] RLS policies configur√©es
- [x] Build r√©ussi
- [ ] Tests de paiement en sandbox
- [ ] Communication aux utilisateurs existants
- [ ] Documentation client mise √† jour
- [ ] Formation support client

---

## üéâ R√©sum√©

Le nouveau syst√®me de tarification xCrackz offre :
- **5 plans flexibles** de 9,99‚Ç¨ √† 119,99‚Ç¨
- **Abonnements annuels** avec 20% de r√©duction
- **Tracking GPS gratuit** pour plans Pro+
- **Co√ªts transparents** par fonctionnalit√©
- **Renouvellement automatique** tous les 30 jours
- **Syst√®me de cr√©dits** clair et pr√©visible

‚úÖ Pr√™t pour le d√©ploiement en production !
